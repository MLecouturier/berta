!function(e,t){"use strict";e.getQueryParams=function(){var e=location.search.slice(1).split("&"),t={};return e.forEach(function(e){e[0]&&(e=e.split("="),t[e[0]]=decodeURIComponent(e[1]||""))}),t},e.getCurrentSite=function(){var e=getQueryParams();return void 0===e.site?"0":e.site},e.escapeHTML=function(e){var n=t.createElement("div"),s=t.createTextNode(e);return n.appendChild(s),n.innerHTML},e.getAllTemplates=function(){var e=redux_store.getState().template_settings.toJSON();return Object.getOwnPropertyNames(e)};var n={templates:{}};n.load=function(){var e=t.getElementById("templateList");if(e){var n=Array.prototype.slice.call(e.querySelectorAll("script"),0);n.forEach(function(e,t){"text/template"===e.getAttribute("type")&&(this.templates[e.getAttribute("id")]=e.innerHTML)}.bind(this))}}.bind(n),n.get=function(e,t){var n=this.templates[e];return n.replace(/<\%=([^%>]+)\%>/g,function(e,n){return t[n]})}.bind(n),e.Templates=n,e.domReady=function(n){var s=!1,o=function(){t.addEventListener?(t.removeEventListener("DOMContentLoaded",i),e.removeEventListener("load",i)):(t.detachEvent("onreadystatechange",i),e.detachEvent("onload",i))},i=function(){s||!t.addEventListener&&"load"!==event.type&&"complete"!==t.readyState||(s=!0,o(),n())};if("complete"===t.readyState)n();else if(t.addEventListener)t.addEventListener("DOMContentLoaded",i),e.addEventListener("load",i);else{t.attachEvent("onreadystatechange",i),e.attachEvent("onload",i);var r=!1;try{r=null===e.frameElement&&t.documentElement}catch(c){}r&&r.doScroll&&!function a(){if(!s){try{r.doScroll("left")}catch(e){return setTimeout(a,50)}s=!0,o(),n()}}()}}}(window,document),function(e,t){"use strict";e.API_ROOT="/_api/v1/",e.editables={xEditable:"xEditable",xEditableColor:"xEditableColor",xEditableSelect:"xEditableSelect",xEditableSelectRC:"xEditableSelectRC",xEditableFontSelect:"xEditableFontSelect",xEditableImage:"xEditableImage",xEditableICO:"xEditableICO",xEditableTA:"xEditableTA",xEditableMCE:"xEditableMCE",xEditableMCESimple:"xEditableMCESimple",xEditableRC:"xEditableRC",xEditableYesNo:"xEditableYesNo",xEmpty:"xEmpty"},e.formats={text:editables.xEditable,longtext:editables.xEditableTA,richtext:editables.xEditableMCESimple,color:editables.xEditableColor,image:editables.xEditableImage,icon:editables.xEditableICO,select:editables.xEditableSelectRC,fontselect:editables.xEditableFontSelect}}(window,document),function(e,t){"use strict";e.ActionTypes={GET_STATE:"GET_STATE",SET_STATE:"SET_STATE",CREATE_SITE:"CREATE_SITE",SITE_CREATED:"SITE_CREATED",UPDATE_SITE:"UPDATE_SITE",SITE_UPDATED:"SITE_UPDATED",DELETE_SITE:"DELETE_SITE",SITE_DELETED:"SITE_DELETED",ORDER_SITES:"ORDER_SITES",CREATE_SECTION:"CREATE_SECTION",SECTION_CREATED:"SECTION_CREATED",UPDATE_SECTION:"UPDATE_SECTION",SECTION_UPDATED:"SECTION_UPDATED",DELETE_SECTION:"DELETE_SECTION",SECTION_DELETED:"SECTION_DELETED",ORDER_SECTIONS:"ORDER_SECTIONS",SECTION_BG_ORDER:"SECTION_BG_ORDER"}}(window,document),function(e,t){"use strict";e.Actions=e.Actions||{},Object.assign(e.Actions,{getState:function(e){return{type:ActionTypes.GET_STATE,meta:{remote:!0,url:"/_api/v1/state/"+e,dispatch:"setState"}}},setState:function(e){return{type:ActionTypes.SET_STATE,state:e}}})}(window,document),function(e,t){"use strict";e.Actions=e.Actions||{},Object.assign(e.Actions,{createSite:function(e,t){return{type:ActionTypes.CREATE_SITE,meta:{remote:!0,url:API_ROOT+"create-site",method:"POST",dispatch:"siteCreated",onComplete:t,data:{site:e}}}},siteCreated:function(e){return{type:ActionTypes.SITE_CREATED,site:e}},updateSite:function(e,t,n){return{type:ActionTypes.UPDATE_SITE,meta:{remote:!0,url:API_ROOT+"update-site",method:"PATCH",data:{path:e,value:t},dispatch:"siteUpdated",onComplete:n},path:e,value:t}},siteUpdated:function(e){return{type:ActionTypes.SITE_UPDATED,resp:e}},deleteSite:function(e,t){return{type:ActionTypes.DELETE_SITE,meta:{remote:!0,url:API_ROOT+"delete-site/"+encodeURIComponent(e),method:"DELETE",dispatch:"siteDeleted",onComplete:t}}},siteDeleted:function(e){return{type:ActionTypes.SITE_DELETED,resp:e}},orderSites:function(e,t){return{type:ActionTypes.ORDER_SITES,meta:{remote:!0,method:"PUT",url:API_ROOT+"order-sites",data:e,onComplete:t},sites:e}}})}(window,document),function(e,t){"use strict";e.Actions=e.Actions||{},Object.assign(e.Actions,{})}(window,document),function(e,t){"use strict";e.Actions=e.Actions||{},Object.assign(e.Actions,{createSection:function(e,t,n,s){return{type:ActionTypes.CREATE_SECTION,meta:{remote:!0,url:API_ROOT+"create-section",method:"POST",dispatch:"sectionCreated",onComplete:s,data:{site:e,name:t,title:n}}}},sectionCreated:function(e){return{type:ActionTypes.SECTION_CREATED,resp:e}},updateSection:function(e,t,n){return{type:ActionTypes.UPDATE_SECTION,meta:{remote:!0,url:API_ROOT+"update-section",method:"PATCH",data:{path:e,value:t},dispatch:"sectionUpdated",onComplete:n},path:e,value:t}},sectionUpdated:function(e){return{type:ActionTypes.SECTION_UPDATED,resp:e}},deleteSection:function(e,t,n){return{type:ActionTypes.DELETE_SECTION,meta:{remote:!0,url:API_ROOT+"delete-section/"+encodeURIComponent(e)+"/"+encodeURIComponent(t),method:"DELETE",dispatch:"sectionDeleted",onComplete:n},section:t}},sectionDeleted:function(e){return{type:ActionTypes.SECTION_DELETED,resp:e}},orderSections:function(e,t){return{type:ActionTypes.ORDER_SECTIONS,meta:{remote:!0,method:"PUT",url:API_ROOT+"order-sections",data:{site:e,sections:t}},site:e,sections:t}},sectionBgOrder:function(e,t,n,s){return{type:ActionTypes.SECTION_BG_ORDER,meta:{remote:!0,method:"PUT",url:API_ROOT+"section-bg-order",data:{site:e,section:t,files:n},onComplete:s},site:e,section:t,files:n}}})}(window,document),function(e,t){"use strict";e.Actions=e.Actions||{},Object.assign(e.Actions,{})}(window,document),function(e,t){"use strict";e.Actions=e.Actions||{},Object.assign(e.Actions,{})}(window,document),function(e,t){"use strict";function n(e){if(e.status>=200&&e.status<300)return e;var t=new Error(e.statusText);throw t.response=e,t}e.redux_middleware=function(e){return function(t){return function(s){if(s.meta&&s.meta.remote){var o=s.meta.method?s.meta.method:"GET";fetch(s.meta.url,{method:o,headers:{Accept:"application/json","Content-Type":"application/json"},body:"get"===o?void 0:JSON.stringify(s.meta.data)}).then(n).then(function(e){return e.json()}).then(function(t){s.meta&&s.meta.dispatch&&!t.error_message&&e.dispatch(Actions[s.meta.dispatch](t)),s.meta&&s.meta.onComplete&&s.meta.onComplete(t)})["catch"](function(e){console.log("Request failed:",e)})}return t(s)}}}}(window,document),function(e,t){"use strict";e.reducers=e.reducers||{},Object.assign(e.reducers,{sites:function(e,t){var n,s,o,i,r=[];switch(void 0===e&&(e=Immutable.Map()),t.type){case ActionTypes.SET_STATE:return console.log("Sites reducer:",t),Immutable.fromJS({site:t.state.site});case ActionTypes.SITE_CREATED:return console.log("Sites reducer:",t),r=e.getIn(["site"]).toJSON(),r.push(t.site),e.setIn(["site"],Immutable.fromJS(r));case ActionTypes.UPDATE_SITE:return console.log("Sites reducer:",t),n=t.path.split("/"),s=t.value,e.setIn(n,s);case ActionTypes.SITE_UPDATED:return console.log("Sites reducer:",t),n=t.resp.path.split("/"),s=t.resp.value,e.setIn(n,s);case ActionTypes.SITE_DELETED:return r=e.getIn(["site"]).toJSON(),o="0"===t.resp.name?"":t.resp.name,i=r.findIndex(function(e,t){return e.name===o}),i>-1?(console.log("Sites reducer:",t),r.splice(i,1),e.setIn(["site"],Immutable.fromJS(r))):e;case ActionTypes.ORDER_SITES:return t.sites.forEach(function(t,n){var s="0"===t?"":t;t=e.getIn(["site"]).toJSON().find(function(e,t){return e.name===s}),t&&r.push(t)}),r.length>0?(console.log("Sites reducer:",t),e.setIn(["site"],Immutable.fromJS(r))):e;default:return e}}})}(window,document),function(e,t){"use strict";e.reducers=e.reducers||{},Object.assign(e.reducers,{site_settings:function(e,t){switch(void 0===e&&(e=Immutable.Map()),t.type){case ActionTypes.SET_STATE:return console.log("Site settings reducer:",t),Immutable.fromJS(t.state.site_settings);default:return e}}})}(window,document),function(e,t){"use strict";e.reducers=e.reducers||{},Object.assign(e.reducers,{site_template_settings:function(e,t){switch(void 0===e&&(e=Immutable.Map()),t.type){case ActionTypes.SET_STATE:return console.log("Site template settings reducer:",t),Immutable.fromJS(t.state.site_template_settings);default:return e}}})}(window,document),function(e,t){"use strict";e.reducers=e.reducers||{},Object.assign(e.reducers,{template_settings:function(e,t){switch(void 0===e&&(e=Immutable.Map()),t.type){case ActionTypes.SET_STATE:return console.log("Template settings reducer:",t),Immutable.fromJS(t.state.template_settings);default:return e}}})}(window,document),function(e,t){"use strict";e.reducers=e.reducers||{},Object.assign(e.reducers,{sections:function(e,t){var n,s,o=[],i=[],r=[];switch(void 0===e&&(e=Immutable.Map()),t.type){case ActionTypes.SET_STATE:return console.log("Sections reducer:",t),Immutable.fromJS(t.state.sections);case ActionTypes.SECTION_CREATED:return console.log("Sections reducer:",t),o=e.getIn([t.resp.site,"section"]).toJSON(),o.push(t.resp.section),e.setIn([t.resp.site,"section"],Immutable.fromJS(o));case ActionTypes.SECTION_UPDATED:return console.log("Sections reducer:",t),e.setIn([t.resp.site,"section",t.resp.section_idx],Immutable.fromJS(t.resp.section));case ActionTypes.SECTION_DELETED:return o=e.getIn([t.resp.site,"section"]).toJSON(),s=o.findIndex(function(e,n){return e.name===t.resp.name}),s>-1?(console.log("Sections reducer:",t),o.splice(s,1),e.setIn([t.resp.site,"section"],Immutable.fromJS(o))):e;case ActionTypes.ORDER_SECTIONS:return t.sections.forEach(function(s,i){n=e.getIn([t.site,"section"]).toJSON().find(function(e,t){return e.name===s}),n&&o.push(n)}),o.length>0?(console.log("Sections reducer:",t),e.setIn([t.site,"section"],Immutable.fromJS(o))):e;case ActionTypes.SECTION_BG_ORDER:return console.log("Sections reducer:",t),o=e.getIn([t.site,"section"]).toJSON(),s=o.findIndex(function(e,n){return e.name===t.section}),s>-1?(i=o[s].mediaCacheData.file,i=Array.isArray(i)?i:[i],t.files.forEach(function(e){var t=i.find(function(t){return t["@attributes"].src===e});t&&r.push(t)}),o[s].mediaCacheData.file=r,e.setIn([t.site,"section"],Immutable.fromJS(o))):e;default:return e}}})}(window,document),function(e,t){"use strict";e.reducers=e.reducers||{},Object.assign(e.reducers,{entries:function(e,t){var n,s=[];switch(void 0===e&&(e=Immutable.Map()),t.type){case ActionTypes.SET_STATE:return console.log("Entries reducer:",t),Immutable.fromJS(t.state.entries);case ActionTypes.SECTION_CREATED:return console.log("Entries reducer:",t),s=e.getIn([t.resp.site]).toJSON(),s[t.resp.section.name]=t.resp.entries,e.setIn([t.resp.site],Immutable.fromJS(s));case ActionTypes.SECTION_UPDATED:return t.resp.old_name?(console.log("Entries reducer:",t),s=e.getIn([t.resp.site]).toJSON(),n=s[t.resp.old_name],n["@attributes"].section=t.resp.section.name,s[t.resp.section.name]=n,delete s[t.resp.old_name],e.setIn([t.resp.site],Immutable.fromJS(s))):e;case ActionTypes.SECTION_DELETED:return console.log("Entries reducer:",t),s=e.getIn([t.resp.site]).toJSON(),delete s[t.resp.name],e.setIn([t.resp.site],Immutable.fromJS(s));default:return e}}})}(window,document),function(e,t){"use strict";e.reducers=e.reducers||{},Object.assign(e.reducers,{tags:function(e,t){var n,s=[];switch(void 0===e&&(e=Immutable.Map()),t.type){case ActionTypes.SET_STATE:return console.log("Tags reducer:",t),Immutable.fromJS(t.state.tags);case ActionTypes.SECTION_CREATED:return s=e.getIn([t.resp.site,"section"]).toJSON(),t.resp.tags.len>0?(console.log("Tags reducer:",t),s.push(t.resp.tags),e.setIn([t.resp.site,"section"],Immutable.fromJS(s))):e;case ActionTypes.SECTION_UPDATED:return t.resp.old_name&&(s=e.getIn([t.resp.site,"section"]).toJSON(),n=s.findIndex(function(e,n){return e["@attributes"].name===t.resp.old_name}),n>-1)?(console.log("Tags reducer:",t),s[n]["@attributes"].name=t.resp.section.name,e.setIn([t.resp.site,"section"],Immutable.fromJS(s))):e;case ActionTypes.SECTION_DELETED:return s=e.getIn([t.resp.site,"section"]).toJSON(),n=s.findIndex(function(e,n){return e["@attributes"].name===t.resp.name}),n>-1?(console.log("Tags reducer:",t),s.splice(n,1),e.setIn([t.resp.site,"section"],Immutable.fromJS(s))):e;default:return e}}})}(window,document),function(e,t){"use strict";e.root_reducer=Redux.combineReducers(reducers)}(window,document),function(e,t){"use strict";var n=Redux.applyMiddleware(redux_middleware)(Redux.createStore),s=getCurrentSite();domReady(Templates.load),e.redux_store=n(root_reducer),redux_store.dispatch(Actions.getState(s))}(window,document);
//# sourceMappingURL=maps/ng-backend.min.js.map
